<template>
  <div>
    <NuxtPage />
    <GlassmorphismAuthModal
      :is-open="isModalOpen"
      @close="auth.close()"
      @auth-success="onAuthSuccess"
    />
  </div>
</template>

<script setup>
import { useAuthModal } from '~/composables/useAuthModal'
import { computed } from 'vue'

const auth = useAuthModal()
const isModalOpen = computed(() => auth.isOpen.value)

function onAuthSuccess(data) {
  auth.close()
  if (process.client) {
    try {
      localStorage.setItem('auth_user', JSON.stringify(data?.user || {}))
      localStorage.setItem('auth_provider', (data && data.provider) || 'email')
      if (data?.token) {
        localStorage.setItem('access_token', data.token)
        localStorage.setItem('anwalts_auth_token', data.token)
      }
    } catch {}
  }
  navigateTo('/dashboard')
}
</script>
<style>
/* global tour removal */
.tour-overlay,.tour-step,#tourOverlay,#tourStep,#btnHelp,#btnStartTour{display:none!important}
</style>
